<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Blocks / Editor</title>

        <!-- Bootstrap-->
        <link href="/css/bootstrap.min.css" rel="stylesheet">
        <link href="/css/bootflat.min.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,700,300,600,800,400' rel='stylesheet' type='text/css'>
        <link href="/css/editor.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <!-- header bar -->
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <span class="navbar-brand">Blocks</span>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a data-toggle="modal" data-target="#modal-new">New</a></li>
                        <li><a data-toggle="modal" data-target="#modal-save">Save</a></li>
                        <li><a data-toggle="modal" data-target="#modal-load">Load</a></li>
                        <li id="nav-header-steps-btn"><a data-toggle="modal" data-target="#modal-steps">Steps</a></li>
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <!-- <li><a href="/puzzles">Puzzles</a></li> -->
                        <li id="nav-header-edit-puzzle-btn" class="nav-header-edit-puzzle"><a>Edit Puzzle</a></li>
                        <li id="nav-header-edit-puzzle-steps-btn" class="nav-header-edit-puzzle"><a>Edit Steps</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- <div class="modal fade in" style="display: block;">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel">Acorn test</h4>
                    </div>
                    <div class="modal-body" id="acorn-test-text">

                    </div>
                </div>
            </div>
        </div> -->

        <!-- main content -->
        <div class="main">
            <!-- main editor panels -->
            <div class="main-panels">
                <div class="panel-container" id="application-panel">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="buttons">
                                <button class="btn btn-default btn-run ui-switch-workspace">Switch Workspace</button>
                                <button class="btn btn-default btn-run" id="application-btn-run">Run</button>
                            </div>

                            <h3 class="panel-title">
                                Application / <span id="application-current-name"></span>
                            </h3>
                        </div>
                        <div class="panel-body" id="application-blockly" style="position: absolute"></div>
                    </div>
                </div>

                <div class="panel-container" id ="testing-panel">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="buttons">
                                <button class="btn btn-default btn-run ui-switch-workspace">Switch Workspace</button>
                                <button class="btn btn-default btn-run" id="testing-btn-run-all">Run All</button>
                            </div>

                            <div class="dropdown">
                                <h3 class="panel-title dropdown-toggle" id="testing-dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    Tests / <span id="testing-current-name"></span>
                                    <span class="caret"></span>
                                </h3>

                                <ul class="dropdown-menu" id="testing-select-menu" aria-labelledby="testing-dropdownMenu">

                                </ul>
                            </div>
                        </div>
                        <div class="panel-body" id="testing-blockly" style="position: absolute"></div>
                    </div>
                </div>
            </div>

            <div class="output-panel">
                <div class="panel-container" id="output-panel">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="buttons">
                                <button class="btn btn-default btn-run" id="output-btn-clear">Clear</button>
                            </div>

                            <h3 class="panel-title">
                                <a id="output-panel-collapse-toggle" class="output-panel-collapse-toggle-open"></a>
                                Output
                            </h3>
                        </div>
                        <div class="panel-body" id="output">

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden file input for openning a local file -->
        <input type="file" id="header-load-fileInput" accept=".vbpuz" style="display: none;"/>

        <!-- New Puzzle Modal -->
        <div class="modal fade" id="modal-new" tabindex="-1" role="dialog" aria-labelledby="New Puzzle">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">New Puzzle</h4>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to create a new empty Workspace or create your own Puzzle, any unsaved changes to the current Workspace will be lost.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="modal-new-btn">Empty Workspace</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="modal-new-puzzle-btn">New Puzzle</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Puzzle Modal -->
        <div class="modal fade" id="modal-save" tabindex="-1" role="dialog" aria-labelledby="Save Puzzle">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Save Puzzle</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label for="inputSaveName" class="col-sm-3 control-label">Puzzle Name</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" id="inputSavePuzzleName">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="modal-save-locally-btn">Save locally</button>
                        <button type="button" class="btn btn-success" data-dismiss="modal" id="modal-save-publish-btn">Publish online</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Load Puzzle Modal -->
        <div class="modal fade" id="modal-load" tabindex="-1" role="dialog" aria-labelledby="Load Puzzle">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Load Puzzle</h4>
                    </div>
                    <div class="modal-body">
                        Puzzles can be loaded from your computer or you can browse the user published puzzles
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="modal-load-locally-btn">Load locally</button>
                        <button type="button" class="btn btn-success" data-dismiss="modal" id="modal-load-publish-btn">View published</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add new test Modal -->
        <div class="modal fade" id="modal-tests-new" tabindex="-1" role="dialog" aria-labelledby="Add Test">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Add Test</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label for="input-tests-new-name" class="col-sm-2 control-label">Name</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="input-tests-new-name">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="modal-tests-new-cancel-btn">Cancel</button>
                        <button type="button" class="btn btn-primary" id="modal-tests-new-btn">Add</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit tests list Modal -->
        <div class="modal fade" id="modal-tests-edit-list" tabindex="-1" role="dialog" aria-labelledby="Edit Tests">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Edit Tests</h4>
                    </div>
                    <div class="modal-body" id="modal-tests-edit-tests-list">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit test Modal -->
        <div class="modal fade" id="modal-tests-edit" tabindex="-1" role="dialog" aria-labelledby="Edit Test">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Rename Test</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal">
                            <input type="hidden" id="input-tests-edit-id">
                            <div class="form-group">
                                <label for="input-tests-new-name" class="col-sm-2 control-label">Name</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" id="input-tests-edit-name">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" id="modal-tests-edit-cancel-btn">Cancel</button>
                        <button type="button" class="btn btn-primary" id="modal-tests-edit-btn">Rename</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Steps list Modal -->
        <div class="modal fade" id="modal-steps" tabindex="-1" role="dialog" aria-labelledby="Steps">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Steps</h4>
                    </div>
                    <div class="modal-body" id="modal-steps-list">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test execute inspect Modal -->
        <div class="modal fade" id="modal-test-execute-inspect" tabindex="-1" role="dialog" aria-labelledby="Test Execute Inspect">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Test Execution Inspect</h4>
                    </div>
                    <div class="modal-body" id="modal-test-execute-inspect-data">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Puzzle Modal -->
        <div class="modal fade" id="modal-edit-puzzle" tabindex="-1" role="dialog" aria-labelledby="Edit Puzzle">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Edit Puzzle</h4>
                    </div>
                    <div class="modal-body" id="modal-edit-puzzle-data">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="modal-edit-puzzle-data-save-btn">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Puzzle Steps Modal -->
        <div class="modal fade" id="modal-edit-steps-list" tabindex="-1" role="dialog" aria-labelledby="Edit Steps">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Edit Steps</h4>
                    </div>
                    <div class="modal-body" id="modal-edit-steps-data">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="modal-edit-steps-add-btn">Add Step</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Puzzle Step Modal -->
        <div class="modal fade" id="modal-edit-steps-edit" tabindex="-1" role="dialog" aria-labelledby="Edit Step">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Edit Step</h4>
                    </div>
                    <div class="modal-body" id="modal-edit-steps-edit-body">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" id="modal-edit-steps-edit-cancel-btn">Cancel</button>
                        <button type="button" class="btn btn-primary" id="modal-edit-steps-edit-save-btn">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Puzzle Step Select Block Modal -->
        <div class="modal fade" id="modal-edit-steps-select-block" tabindex="-1" role="dialog" aria-labelledby="Select Block">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Select Block</h4>
                    </div>
                    <div class="modal-body">
                        <div id="modal-edit-steps-select-block-body" style="height: 520px; width: 100%;"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Puzzle Complete Modal -->
        <div class="modal fade" id="modal-puzzle-complete" tabindex="-1" role="dialog" aria-labelledby="Puzzle Complete">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Congratulations</h4>
                    </div>
                    <div class="modal-body" id="modal-edit-steps-edit-body">
                        You've completed this puzzle
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="mobile-detect"></div>

        <!-- Shared Blockly Toolbox -->
        <xml id="blockly-shared-toolbox" style="display: none">
            <category name="Logic" colour="210">
                <block type="controls_if"></block>
                <block type="logic_compare"></block>
                <block type="logic_operation"></block>
                <block type="logic_negate"></block>
                <block type="logic_boolean"></block>
                <!-- <block type="logic_ternary"></block> -->
            </category>
            <category name="Loops" colour="120">
                <block type="controls_repeat_ext">
                    <value name="TIMES">
                        <shadow type="math_number">
                            <field name="NUM">10</field>
                        </shadow>
                    </value>
                </block>
                <block type="controls_whileUntil"></block>
                <block type="controls_for">
                    <value name="FROM">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                    <value name="TO">
                        <shadow type="math_number">
                            <field name="NUM">10</field>
                        </shadow>
                    </value>
                    <value name="BY">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                </block>
                <block type="controls_forEach"></block>
                <block type="controls_flow_statements"></block>
            </category>
            <category name="Math" colour="230">
                <block type="math_number" gap="32"></block>
                <block type="math_arithmetic">
                    <value name="A">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                    <value name="B">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_single">
                    <value name="NUM">
                        <shadow type="math_number">
                            <field name="NUM">9</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_trig">
                    <value name="NUM">
                        <shadow type="math_number">
                            <field name="NUM">45</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_constant"></block>
                <block type="math_number_property">
                    <value name="NUMBER_TO_CHECK">
                        <shadow type="math_number">
                            <field name="NUM">0</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_change">
                    <value name="DELTA">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_round">
                    <value name="NUM">
                        <shadow type="math_number">
                            <field name="NUM">3.1</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_on_list"></block>
                <block type="math_modulo">
                    <value name="DIVIDEND">
                        <shadow type="math_number">
                            <field name="NUM">64</field>
                        </shadow>
                    </value>
                    <value name="DIVISOR">
                        <shadow type="math_number">
                            <field name="NUM">10</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_constrain">
                    <value name="VALUE">
                        <shadow type="math_number">
                            <field name="NUM">50</field>
                        </shadow>
                    </value>
                    <value name="LOW">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                    <value name="HIGH">
                        <shadow type="math_number">
                            <field name="NUM">100</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_random_int">
                    <value name="FROM">
                        <shadow type="math_number">
                            <field name="NUM">1</field>
                        </shadow>
                    </value>
                    <value name="TO">
                        <shadow type="math_number">
                            <field name="NUM">100</field>
                        </shadow>
                    </value>
                </block>
                <block type="math_random_float"></block>
            </category>
            <category name="Text" colour="160">
                <block type="text"></block>
                <block type="text_join"></block>
                <block type="text_append">
                    <value name="TEXT">
                        <shadow type="text"></shadow>
                    </value>
                </block>
                <block type="text_length">
                    <value name="VALUE">
                        <shadow type="text">
                            <field name="TEXT">abc</field>
                        </shadow>
                    </value>
                </block>
                <block type="text_isEmpty">
                    <value name="VALUE">
                        <shadow type="text">
                            <field name="TEXT"></field>
                        </shadow>
                    </value>
                </block>
                <block type="text_indexOf">
                    <value name="VALUE">
                        <block type="variables_get">
                            <field name="VAR">text</field>
                        </block>
                    </value>
                    <value name="FIND">
                        <shadow type="text">
                            <field name="TEXT">abc</field>
                        </shadow>
                    </value>
                </block>
                <block type="text_charAt">
                    <value name="VALUE">
                        <block type="variables_get">
                            <field name="VAR">text</field>
                        </block>
                    </value>
                </block>
                <block type="text_getSubstring">
                    <value name="STRING">
                        <block type="variables_get">
                            <field name="VAR">text</field>
                        </block>
                    </value>
                </block>
                <block type="text_changeCase">
                    <value name="TEXT">
                        <shadow type="text">
                            <field name="TEXT">abc</field>
                        </shadow>
                    </value>
                </block>
                <block type="text_trim">
                    <value name="TEXT">
                        <shadow type="text">
                            <field name="TEXT">abc</field>
                        </shadow>
                    </value>
                </block>
                <block type="text_print">
                    <value name="TEXT">
                        <shadow type="text">
                            <field name="TEXT">abc</field>
                        </shadow>
                    </value>
                </block>
                <block type="text_prompt_ext">
                    <value name="TEXT">
                        <shadow type="text">
                            <field name="TEXT">abc</field>
                        </shadow>
                    </value>
                </block>
            </category>
            <category name="Lists" colour="260">
                <block type="lists_create_with">
                    <mutation items="0"></mutation>
                </block>
                <block type="lists_create_with"></block>
                <block type="lists_repeat">
                    <value name="NUM">
                        <shadow type="math_number">
                            <field name="NUM">5</field>
                        </shadow>
                    </value>
                </block>
                <block type="lists_length"></block>
                <block type="lists_isEmpty"></block>
                <block type="lists_indexOf">
                    <value name="VALUE">
                        <block type="variables_get">
                            <field name="VAR">list</field>
                        </block>
                    </value>
                </block>
                <block type="lists_getIndex">
                    <value name="VALUE">
                        <block type="variables_get">
                            <field name="VAR">list</field>
                        </block>
                    </value>
                </block>
                <block type="lists_setIndex">
                    <value name="LIST">
                        <block type="variables_get">
                            <field name="VAR">list</field>
                        </block>
                    </value>
                </block>
                <block type="lists_getSublist">
                    <value name="LIST">
                        <block type="variables_get">
                            <field name="VAR">list</field>
                        </block>
                    </value>
                </block>
                <block type="lists_split">
                    <value name="DELIM">
                        <shadow type="text">
                            <field name="TEXT">,</field>
                        </shadow>
                    </value>
                </block>
            </category>
            <sep></sep>
            <category name="Variables" colour="330" custom="VARIABLE"></category>
            <category name="Functions" colour="290" custom="PROCEDURE"></category>
            <sep></sep>
        </xml>

        <!-- Application Only Blockly Toolbox -->
        <xml id="blockly-application-only-toolbox" style="display: none">

        </xml>

        <!-- Tests Only Blockly Toolbox -->
        <xml id="blockly-testing-only-toolbox" style="display: none">
            <category name="Testing" colour="10">
                <block type="assert">
                    <value name="ASSERT_SUCCESS_IF">
                        <block type="logic_boolean">
                            <field name="BOOL">TRUE</field>
                        </block>
                    </value>
                </block>
                <block type="assert">
                    <value name="ASSERT_SUCCESS_IF">
                        <block type="logic_boolean">
                            <field name="BOOL">FALSE</field>
                        </block>
                    </value>
                </block>

                <block type="simulate_input"></block>
                <block type="get_output"></block>
                <block type="ignore_next_output"></block>

                <block type="if_outputs_left"></block>
                <block type="ignore_unhandled_prompt"></block>
                <block type="if_prompts_missed"></block>

                <block type="console_output"></block>
            </category>
        </xml>

        <!-- Templates -->
        <script id="template-testing-select-menu" type="x-tmpl-mustache">
            <li class="dropdown-header">Your Tests</li>
            {{#each tests}}
                <li><a class="testing-dropdown-test-name" data-id="{{@key}}">{{this.name}}</a></li>
            {{/each}}

            {{#if this.options.testListEditable}}
                <li role="separator" class="divider testing-dropdown-manage"></li>
                <li class="dropdown-header testing-dropdown-manage">Manage</li>
                <li><a id="testing-dropdown-new" class="testing-dropdown-manage">Add new test</a></li>
                <li><a id="testing-dropdown-edit" class="testing-dropdown-manage">Edit tests</a></li>
            {{/if}}
        </script>

        <script id="template-edit-tests-list" type="x-tmpl-mustache">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Last Run</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {{#each tests}}
                        <tr>
                            <td>{{this.name}}</td>
                            <td>{{{this.result}}}</td>
                            <td>
                                <button type="button" class="btn btn-info btn-xs btn-edit" data-id="{{@key}}">Rename</button>
                                {{#if ../allowDelete}}
                                    <button type="button" class="btn btn-danger btn-xs btn-delete" data-id="{{@key}}">Delete</button>
                                {{else}}
                                    <button type="button" class="btn btn-danger btn-xs btn-delete" disabled>Delete</button>
                                {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                </tbody>
            </table>
        </script>

        <script id="template-tests-runall-output" type="x-tmpl-mustache">
            <strong>Running all tests</strong>

            <table class="testing-results-table">
                {{#each tests}}
                    <tr>
                        <td>{{this.name}}</td>
                        <td>{{{this.formattedResult}}}</td>
                        <td><a class="testing-results-table-test-inspect" data-id="{{@key}}">Inspect</a></td>
                    </tr>
                {{/each}}
            </table>

            {{#if_eq this.numPassed 0}}
                <strong>All tests failed</strong>
            {{else}}
                {{#if_eq this.numPassed this.numTests}}
                    <strong>All tests passed</strong>
                {{else}}
                    <strong>{{numPassed}} out of {{numTests}} tests passed</strong>
                {{/if_eq}}
            {{/if_eq}}
        </script>

        <script id="template-test-formatted-output" type="x-tmpl-mustache">
            {{#if assertion}}
                {{#if success}}
                    <span class="bg-success">SUCCESS</span>
                {{else}}
                    <span class="bg-danger">
                        FAILED
                        {{#if unhandledPrompt}}
                             - UNHANDLED PROMPT
                        {{/if}}
                    </span>
                {{/if}}
            {{else}}
                <span class="bg-danger">FAILED - NO ASSERT</span>
            {{/if}}
        </script>

        <script id="template-steps-list" type="x-tmpl-mustache">
            <div class="steps-list">
                {{#each steps}}
                    <div class="media">
                        <div class="media-left media-middle steps-list-status">
                            {{#if this.hasSuccessCondition}}
                                {{#if this.completed}}
                                    <span class="steps-list-status-complete">&#x2713</span>
                                {{else}}
                                    <span class="steps-list-status-incomplete">&#x2717</span>
                                {{/if}}
                            {{else}}
                                <span class="steps-list-status-nocondition">&nbsp;</span>
                            {{/if}}
                        </div>
                        <div class="media-body">
                            {{#if this.display_details}}
                                <h4 class="media-heading">{{this.title}}</h4>
                                {{this.description}}
                            {{else}}
                                <h4 class="media-heading"><i>???</i></h4>
                                <i>Step must be completed before it is shown</i>
                            {{/if}}
                        </div>
                    </div>
                {{/each}}
            </div>

            {{#if progress.display}}
                <div class="steps-progress">
                    <div class="progress">
                        {{#if_eq progress.percent 100}}
                            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
                                Complete!
                            </div>
                        {{else}}
                            <div class="progress-bar" role="progressbar" aria-valuenow="{{progress.percent}}" aria-valuemin="0" aria-valuemax="100" style="width: {{progress.percent}}%;min-width: 40px;">
                                {{progress.completed}}/{{progress.total}}
                            </div>
                        {{/if_eq}}
                    </div>
                </div>
            {{/if}}
        </script>

        <script id="template-test-execute-inspect" type="x-tmpl-mustache">
            <table>
                <tr>
                    <th>Name</th>
                    <td>{{test.name}}</td>
                </tr>
                <tr>
                    <th>Success</th>
                    <td>{{result.success}}</td>
                </tr>
                <tr>
                    <th>Assertion</th>
                    <td>{{result.assertion}}</td>
                </tr>
                <tr>
                    <th>Unhandled prompt</th>
                    <td>{{result.unhandledPrompt}}</td>
                </tr>
            </table>

            <br/>
            <strong>Execution log</strong><br/>
            {{#each result.executionLog}}
                {{#if_eq this.type 'assert'}}
                    ASSERTION: {{this.value}} == {{this.check_if}}
                {{/if_eq}}
                {{#if_eq this.type 'print'}}
                    PRINT: {{this.value}}
                {{/if_eq}}
                {{#if_eq this.type 'prompt'}}
                    PROMPT: {{this.text}} | given {{this.value}}
                {{/if_eq}}
                {{#if_eq this.type 'variable_set'}}
                    SET VAR: {{this.name}} = {{this.value}} &lt;{{this.value.type}}&gt;
                {{/if_eq}}
                <br/>
            {{/each}}

            <br/>
            <strong>Final Variables Value</strong><br/>
            {{#each result.variables}}
                {{@key}}: {{this.data}} &lt;{{this.type}}&gt;
                <br/>
            {{/each}}
        </script>

        <script id="template-edit-puzzle-data" type="x-tmpl-mustache">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="edit-puzzle-name" class="col-sm-3 control-label">Name</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="edit-puzzle-name" value="{{name}}" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-puzzle-description" class="col-sm-3 control-label">Description</label>
                    <div class="col-sm-9">
                        <textarea class="form-control" id="edit-puzzle-description">{{description}}</textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Options</label>
                    <div class="col-sm-9 edit-puzzle-options">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" id="edit-puzzle-opt-applicationvisible" {{#if options.applicationCodeVisible}}checked{{/if}}>
                                Application code visible
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" id="edit-puzzle-opt-applicationeditable" {{#if options.applicationCodeEditable}}checked{{/if}}>
                                Application code editable
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" id="edit-puzzle-opt-testcodeeditable" {{#if options.testCodeEditable}}checked{{/if}}>
                                Test code editable
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" id="edit-puzzle-opt-testlisteditable" {{#if options.testListEditable}}checked{{/if}}>
                                Test list editable
                            </label>
                        </div>
                    </div>
                </div>
            </form>
        </script>

        <script id="template-edit-puzzle-steps-list" type="x-tmpl-mustache">
            <table class="table">
                <thead>
                    <tr>
                        <th>Order</th>
                        <th>Name</th>
                        <th>Condition</th>
                        <th width="104"></th>
                    </tr>
                </thead>
                <tbody>
                {{#each steps}}
                    <tr>
                        <td>
                            <button type="button" class="btn btn-primary btn-order" data-id="{{this.id}}" data-direction="up" {{#if_eq this.order 0}}disabled{{/if_eq}}>&#x25B2</button>
                            <button type="button" class="btn btn-primary btn-order" data-id="{{this.id}}" data-direction="down" {{#if_eq_math this.order ../steps.length -1}}disabled{{/if_eq_math}}>&#x25BC</button>
                        </td>
                        <td>{{this.title}}</td>
                        <td>
                            {{#if this.successCondition}}
                                {{this.successCondition.event}}
                            {{else}}
                                <i>None</i>
                            {{/if}}
                        </td>
                        <td>
                            <button type="button" class="btn btn-info btn-xs btn-edit" data-id="{{this.id}}">Edit</button>
                            <button type="button" class="btn btn-danger btn-xs btn-delete" data-id="{{this.id}}">Delete</button>
                        </td>
                    </tr>
                {{/each}}
                </tbody>
            </table>
        </script>

        <script id="template-edit-puzzle-steps-edit" type="x-tmpl-mustache">
            <input type="hidden" id="edit-puzzle-step-id" value="{{id}}" />
            <input type="hidden" id="edit-puzzle-step-order" value="{{step.order}}" />

            <form class="form-horizontal">
                <div class="form-group">
                    <label for="edit-puzzle-step-title" class="col-sm-3 control-label">Title</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="edit-puzzle-step-title" value="{{step.title}}" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-puzzle-step-description" class="col-sm-3 control-label">Description</label>
                    <div class="col-sm-9">
                        <textarea class="form-control" id="edit-puzzle-step-description">{{step.description}}</textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-puzzle-step-description" class="col-sm-3 control-label">Visibility</label>
                    <div class="col-sm-9">
                        <select class="form-control" id="edit-puzzle-step-visibility">
                            <option value="visible" {{#if_eq step.visibility 'visible'}}selected{{/if_eq}}>Visible</option>
                            <option value="visible_on_success" {{#if_eq step.visibility 'visible_on_success'}}selected{{/if_eq}}>Visible on success</option>
                            <option value="not_visible" {{#if_eq step.visibility 'not_visible'}}selected{{/if_eq}}>Not Visible</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-puzzle-step-success-event" class="col-sm-3 control-label">Success Event</label>
                    <div class="col-sm-9">
                        <select class="form-control" id="edit-puzzle-step-success-event">
                            {{#each event_definitions}}
                                <option value="{{@key}}" {{#if_eq @key ../step.successCondition.event}}selected{{/if_eq}}>{{this.name}}</option>
                            {{/each}}
                        </select>
                    </div>
                </div>
            </form>

            <div id="modal-edit-steps-edit-body-success-condition">

            </div>
        </script>

        <script id="template-edit-puzzle-steps-edit-success-condition" type="x-tmpl-mustache">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="edit-puzzle-step-prereq" class="col-sm-3 control-label">Prerequisites</label>
                    <div class="col-sm-9">
                        <select multiple class="form-control" id="edit-puzzle-step-success-prereq">
                            {{#step_prereq step id}}
                                <option value="{{this.id}}" {{#if this.selected}}selected{{/if}}>{{this.step.title}}</option>
                            {{/step_prereq}}
                        </select>
                    </div>
                </div>
                {{#if event_definition.specific_workspace}}
                <div class="form-group">
                    <label for="edit-puzzle-step-success-workspace" class="col-sm-3 control-label">Workspace</label>
                    <div class="col-sm-9">
                        <select class="form-control" id="edit-puzzle-step-success-workspace">
                            <option value="application">Application</option>
                            <option value="test" {{#if_eq this.step.successCondition.workspace 'test'}}selected{{/if_eq}}>Test</option>
                        </select>
                    </div>
                </div>
                {{/if}}

                {{#each event_definition.equalities}}
                <div class="form-group">
                    <label class="col-sm-3 control-label">{{this.name}}</label>
                    <div class="col-sm-9">
                        <div class="row">
                            {{#step_equality_values @key ../step this}}
                                <div class="col-md-6">
                                    {{this.variable.name}}
                                </div>
                                <div class="col-md-6">
                                    {{#if_eq this.variableID 'type'}}
                                        <input type="hidden" value="{{this.value}}" data-equality="{{this.equality}}" data-variable="{{this.variableID}}" id="event-step-equality-value-{{this.equality}}-{{this.variableID}}" class="event-step-equality-block-type-value"/>
                                        <button class="form-control btn btn-default event-step-equality-block-type-btn" data-equality="{{this.equality}}" data-variable="{{this.variableID}}">{{this.value}}</button>
                                    {{else}}
                                        {{#if_eq this.variableID 'function_name'}}
                                            <select class="form-control" id="event-step-equality-value-{{this.equality}}-{{this.variableID}}">
                                                <option></option>
                                                {{#each ../../functionNames}}
                                                    <option value="{{this}}" {{#if_eq ../this.value this}}selected{{/if_eq}}>{{this}}</option>
                                                {{/each}}
                                            </select>
                                        {{else}}
                                            {{#if_eq this.variableID 'variable_name'}}
                                                <select class="form-control" id="event-step-equality-value-{{this.equality}}-{{this.variableID}}">
                                                    <option></option>
                                                    {{#each ../../variableNames}}
                                                        <option value="{{this}}" {{#if_eq ../this.value this}}selected{{/if_eq}}>{{this}}</option>
                                                    {{/each}}
                                                </select>
                                            {{else}}
                                                {{#if this.variable.values}}
                                                    <select class="form-control" id="event-step-equality-value-{{this.equality}}-{{this.variableID}}">
                                                        <option></option>
                                                        {{#each this.variable.values}}
                                                            <option value="{{@key}}" {{#if_eq ../this.value @key}}selected{{/if_eq}}>{{this}}</option>
                                                        {{/each}}
                                                    </select>
                                                {{else}}
                                                    <input type="text" class="form-control" id="event-step-equality-value-{{this.equality}}-{{this.variableID}}" value="{{this.value}}"/>
                                                {{/if}}
                                            {{/if_eq}}
                                        {{/if_eq}}
                                    {{/if_eq}}
                                </div>
                            {{/step_equality_values}}
                        </div>
                    </div>
                </div>
                {{/each}}
            </form>
        </script>

        <!-- Scripts -->

        <script src="/js/blockly/blockly_compressed.js"></script>
        <script src="/js/blockly/blocks_compressed.js"></script>
        <script src="/js/blockly/msg_en.js"></script>
        <script src="/js/blockly/javascript_compressed.js"></script>
        <script src="/js/acorn.js"></script>
        <script src="/js/acorn_interpreter.js"></script>
        <script src="/js/filesaver.min.js"></script>
        <script src="/js/handlebars-v4.0.5.js"></script>
        <script src="/js/jquery-2.1.4.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/interact.min.js"></script>

        <script src="/js/editor/puzzles.js"></script>
        <script src="/js/editor/executor.js"></script>
        <script src="/js/editor/output.js"></script>
        <script src="/js/editor/ui.js"></script>
        <script src="/js/editor/workspace.js"></script>
        <script src="/js/editor/main.js"></script>

        <script src="/js/editor/custom_blocks/assert.js"></script>
        <script src="/js/editor/custom_blocks/get_output.js"></script>
        <script src="/js/editor/custom_blocks/simulate_input.js"></script>
        <script src="/js/editor/custom_blocks/if_outputs_left.js"></script>
        <script src="/js/editor/custom_blocks/if_prompts_missed.js"></script>
        <script src="/js/editor/custom_blocks/ignore_unhandled_prompt.js"></script>
        <script src="/js/editor/custom_blocks/ignore_next_output.js"></script>
        <script src="/js/editor/custom_blocks/test_console.js"></script>
    </body>
</html>
